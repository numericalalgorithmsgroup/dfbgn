%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{times}
\expandafter\ifx\csname T@LGR\endcsname\relax
\else
% LGR was declared as font encoding
  \substitutefont{LGR}{\rmdefault}{cmr}
  \substitutefont{LGR}{\sfdefault}{cmss}
  \substitutefont{LGR}{\ttdefault}{cmtt}
\fi
\expandafter\ifx\csname T@X2\endcsname\relax
  \expandafter\ifx\csname T@T2A\endcsname\relax
  \else
  % T2A was declared as font encoding
    \substitutefont{T2A}{\rmdefault}{cmr}
    \substitutefont{T2A}{\sfdefault}{cmss}
    \substitutefont{T2A}{\ttdefault}{cmtt}
  \fi
\else
% X2 was declared as font encoding
  \substitutefont{X2}{\rmdefault}{cmr}
  \substitutefont{X2}{\sfdefault}{cmss}
  \substitutefont{X2}{\ttdefault}{cmtt}
\fi


\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\contentsname}{Contents:}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{1}



\title{DFBGN}
\date{25 February 2021}
\release{0.1}
\author{Lindon Roberts}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxstylestrong{Release:} 0.1

\sphinxstylestrong{Date:} 25 February 2021

\sphinxstylestrong{Author:} \sphinxhref{mailto:lindon.roberts@anu.edu.au}{Lindon Roberts}

DFBGN is a package for finding local solutions to large\sphinxhyphen{}scale nonlinear least\sphinxhyphen{}squares minimization problems, without requiring any derivatives of the objective. DFBGN stands for Derivative\sphinxhyphen{}Free Block Gauss\sphinxhyphen{}Newton.

That is, DFBGN solves
\begin{equation*}
\begin{split}\min_{x\in\mathbb{R}^n} \quad  f(x) := \sum_{i=1}^{m}r_{i}(x)^2\end{split}
\end{equation*}
Full details of the DFBGN algorithm are given in our paper: Coralia Cartis and Lindon Roberts, \sphinxhref{https://arxiv.org/abs/2102.12016}{Scalable Subspace Methods for Derivative\sphinxhyphen{}Free Nonlinear Least\sphinxhyphen{}Squares Optimization}, \sphinxstyleemphasis{arXiv preprint arXiv:2102.12016}, (2021).

If you wish to solve small\sphinxhyphen{}scale least\sphinxhyphen{}squares problems, you may wish to try \sphinxhref{https://github.com/numericalalgorithmsgroup/dfols}{DFO\sphinxhyphen{}LS}. If you are interested in solving general optimization problems (without a least\sphinxhyphen{}squares structure), you may wish to try \sphinxhref{https://github.com/numericalalgorithmsgroup/pybobyqa}{Py\sphinxhyphen{}BOBYQA}.

DFBGN is released under the GNU General Public License. Please \sphinxhref{http://www.nag.com/content/worldwide-contact-information}{contact NAG} for alternative licensing.


\chapter{Installing DFBGN}
\label{\detokenize{install:installing-dfbgn}}\label{\detokenize{install::doc}}

\section{Requirements}
\label{\detokenize{install:requirements}}
DFBGN requires the following software to be installed:
\begin{itemize}
\item {} 
Python 2.7 or Python 3 (\sphinxurl{http://www.python.org/})

\end{itemize}

Additionally, the following python packages should be installed (these will be installed automatically if using \sphinxstyleemphasis{pip}, see {\hyperref[\detokenize{install:installation-using-pip}]{\sphinxcrossref{Installation using pip}}}):
\begin{itemize}
\item {} 
NumPy 1.11 or higher (\sphinxurl{http://www.numpy.org/})

\item {} 
SciPy 0.18 or higher (\sphinxurl{http://www.scipy.org/})

\item {} 
Pandas 0.17 or higher (\sphinxurl{http://pandas.pydata.org/})

\end{itemize}


\section{Installation using pip}
\label{\detokenize{install:installation-using-pip}}
For easy installation, use \sphinxhref{http://www.pip-installer.org/}{pip} as root:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} \PYG{o}{[}sudo\PYG{o}{]} pip install dfbgn
\end{sphinxVerbatim}
\end{quote}

or alternatively \sphinxstyleemphasis{easy\_install}:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} \PYG{o}{[}sudo\PYG{o}{]} easy\PYGZus{}install dfbgn
\end{sphinxVerbatim}
\end{quote}

If you do not have root privileges or you want to install DFBGN for your private use, you can use:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} pip install \PYGZhy{}\PYGZhy{}user dfbgn
\end{sphinxVerbatim}
\end{quote}

which will install DFBGN in your home directory.

Note that if an older install of DFBGN is present on your system you can use:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} \PYG{o}{[}sudo\PYG{o}{]} pip install \PYGZhy{}\PYGZhy{}upgrade dfbgn
\end{sphinxVerbatim}
\end{quote}

to upgrade DFBGN to the latest version.


\section{Manual installation}
\label{\detokenize{install:manual-installation}}
Alternatively, you can download the source code from \sphinxhref{https://github.com/numericalalgorithmsgroup/dfbgn}{Github} and unpack as follows:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} git clone https://github.com/numericalalgorithmsgroup/dfbgn
\PYGZdl{} \PYG{n+nb}{cd} dfbgn
\end{sphinxVerbatim}
\end{quote}

DFBGN is written in pure Python and requires no compilation. It can be installed using:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} \PYG{o}{[}sudo\PYG{o}{]} pip install .
\end{sphinxVerbatim}
\end{quote}

If you do not have root privileges or you want to install DFBGN for your private use, you can use:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} pip install \PYGZhy{}\PYGZhy{}user .
\end{sphinxVerbatim}
\end{quote}

instead.

To upgrade DFBGN to the latest version, navigate to the top\sphinxhyphen{}level directory (i.e. the one containing \sphinxcode{\sphinxupquote{setup.py}}) and rerun the installation using \sphinxcode{\sphinxupquote{pip}}, as above:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} git pull
\PYGZdl{} \PYG{o}{[}sudo\PYG{o}{]} pip install .  \PYG{c+c1}{\PYGZsh{} with admin privileges}
\end{sphinxVerbatim}
\end{quote}


\section{Testing}
\label{\detokenize{install:testing}}
If you installed DFBGN manually, you can test your installation by running:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} python setup.py \PYG{n+nb}{test}
\end{sphinxVerbatim}
\end{quote}

Alternatively, the HTML documentation provides some simple examples of how to run DFBGN.


\section{Uninstallation}
\label{\detokenize{install:uninstallation}}
If DFBGN was installed using \sphinxstyleemphasis{pip} you can uninstall as follows:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} \PYG{o}{[}sudo\PYG{o}{]} pip uninstall dfbgn
\end{sphinxVerbatim}
\end{quote}

If DFBGN was installed manually you have to remove the installed files by hand (located in your python site\sphinxhyphen{}packages directory).


\chapter{Using DFBGN}
\label{\detokenize{userguide:using-dfbgn}}\label{\detokenize{userguide::doc}}
This section describes the main interface to DFBGN and how to use it.


\section{Nonlinear Least\sphinxhyphen{}Squares Minimization}
\label{\detokenize{userguide:nonlinear-least-squares-minimization}}
DFBGN is designed to solve the local optimization problem
\begin{equation*}
\begin{split}\min_{x\in\mathbb{R}^n} \quad  f(x) := \sum_{i=1}^{m}r_{i}(x)^2\end{split}
\end{equation*}
DFBGN iteratively constructs an interpolation\sphinxhyphen{}based model for the objective, and determines a step using a trust\sphinxhyphen{}region framework. For an in\sphinxhyphen{}depth technical description of the algorithm see the paper \sphinxcite{userguide:cr2021}.


\section{How to use DFBGN}
\label{\detokenize{userguide:how-to-use-dfbgn}}
The main interface to DFBGN is via the function \sphinxcode{\sphinxupquote{solve}}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{soln} \PYG{o}{=} \PYG{n}{dfbgn}\PYG{o}{.}\PYG{n}{solve}\PYG{p}{(}\PYG{n}{objfun}\PYG{p}{,} \PYG{n}{x0}\PYG{p}{,} \PYG{n}{fixed\PYGZus{}block}\PYG{o}{=}\PYG{n}{fixed\PYGZus{}block}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

The input \sphinxcode{\sphinxupquote{objfun}} is a Python function which takes an input \(x\in\mathbb{R}^n\) and returns the vector of residuals \([r_1(x)\: \cdots \: r_m(x)]\in\mathbb{R}^m\). Both the input and output of \sphinxcode{\sphinxupquote{objfun}} must be one\sphinxhyphen{}dimensional NumPy arrays (i.e. with \sphinxcode{\sphinxupquote{x.shape == (n,)}} and \sphinxcode{\sphinxupquote{objfun(x).shape == (m,)}}).

The input \sphinxcode{\sphinxupquote{x0}} is the starting point for the solver, and (where possible) should be set to be the best available estimate of the true solution \(x_{min}\in\mathbb{R}^n\). It should be specified as a one\sphinxhyphen{}dimensional NumPy array (i.e. with \sphinxcode{\sphinxupquote{x0.shape == (n,)}}).
As DFBGN is a local solver, providing different values for \sphinxcode{\sphinxupquote{x0}} may cause it to return different solutions, with possibly different objective values.

The input \sphinxcode{\sphinxupquote{fixed\_block}} is the size of the exploration space. It should be an integer from 1 to \sphinxcode{\sphinxupquote{len(x0)}} inclusive, set based on how fast you want the internal linear algebra calculations to be (smaller values are faster).

The output of \sphinxcode{\sphinxupquote{dfbgn.solve}} is an object containing:
\begin{itemize}
\item {} 
\sphinxcode{\sphinxupquote{soln.x}} \sphinxhyphen{} an estimate of the solution, \(x_{min}\in\mathbb{R}^n\), a one\sphinxhyphen{}dimensional NumPy array.

\item {} 
\sphinxcode{\sphinxupquote{soln.resid}} \sphinxhyphen{} the vector of residuals at the calculated solution, \([r_1(x_{min})\:\cdots\: r_m(x_{min})]\), a one\sphinxhyphen{}dimensional NumPy array.

\item {} 
\sphinxcode{\sphinxupquote{soln.f}} \sphinxhyphen{} the objective value at the calculated solution, \(f(x_{min})\), a Float.

\item {} 
\sphinxcode{\sphinxupquote{soln.nf}} \sphinxhyphen{} the number of evaluations of \sphinxcode{\sphinxupquote{objfun}} that the algorithm needed, an Integer.

\item {} 
\sphinxcode{\sphinxupquote{soln.flag}} \sphinxhyphen{} an exit flag, which can take one of several values (listed below), an Integer.

\item {} 
\sphinxcode{\sphinxupquote{soln.msg}} \sphinxhyphen{} a description of why the algorithm finished, a String.

\item {} 
\sphinxcode{\sphinxupquote{soln.diagnostic\_info}} \sphinxhyphen{} a table of diagnostic information showing the progress of the solver, a Pandas DataFrame.

\end{itemize}

The possible values of \sphinxcode{\sphinxupquote{soln.flag}} are defined by the following variables:
\begin{itemize}
\item {} 
\sphinxcode{\sphinxupquote{soln.EXIT\_SUCCESS}} \sphinxhyphen{} DFBGN terminated successfully (the objective value or trust region radius are sufficiently small).

\item {} 
\sphinxcode{\sphinxupquote{soln.EXIT\_MAXFUN\_WARNING}} \sphinxhyphen{} maximum allowed objective evaluations reached. This is the most likely return value when using multiple restarts.

\item {} 
\sphinxcode{\sphinxupquote{soln.EXIT\_SLOW\_WARNING}} \sphinxhyphen{} maximum number of slow iterations reached.

\item {} 
\sphinxcode{\sphinxupquote{soln.EXIT\_FALSE\_SUCCESS\_WARNING}} \sphinxhyphen{} DFBGN reached the maximum number of restarts which decreased the objective, but to a worse value than was found in a previous run.

\item {} 
\sphinxcode{\sphinxupquote{soln.EXIT\_INPUT\_ERROR}} \sphinxhyphen{} error in the inputs.

\item {} 
\sphinxcode{\sphinxupquote{soln.EXIT\_TR\_INCREASE\_ERROR}} \sphinxhyphen{} error occurred when solving the trust region subproblem.

\item {} 
\sphinxcode{\sphinxupquote{soln.EXIT\_LINALG\_ERROR}} \sphinxhyphen{} linear algebra error, e.g. the interpolation points produced a singular linear system.

\end{itemize}

These variables are defined in the \sphinxcode{\sphinxupquote{soln}} object, so can be accessed with, for example
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{if} \PYG{n}{soln}\PYG{o}{.}\PYG{n}{flag} \PYG{o}{==} \PYG{n}{soln}\PYG{o}{.}\PYG{n}{EXIT\PYGZus{}SUCCESS}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Success!}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}


\section{A Simple Example}
\label{\detokenize{userguide:a-simple-example}}
Suppose we wish to minimize the \sphinxhref{https://en.wikipedia.org/wiki/Rosenbrock\_function}{Rosenbrock test function}:
\begin{equation*}
\begin{split}\min_{(x_1,x_2)\in\mathbb{R}^2}  &\quad  100(x_2-x_1^2)^2 + (1-x_1)^2 \\\end{split}
\end{equation*}
This function has exactly one local minimum \(f(x_{min})=0\) at \(x_{min}=(1,1)\). We can write this as a least\sphinxhyphen{}squares problem as:
\begin{equation*}
\begin{split}\min_{(x_1,x_2)\in\mathbb{R}^2}  &\quad  [10(x_2-x_1^2)]^2 + [1-x_1]^2 \\\end{split}
\end{equation*}
A commonly\sphinxhyphen{}used starting point for testing purposes is \(x_0=(-1.2,1)\). The following script shows how to solve this problem using DFBGN:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} DFBGN example: minimize the Rosenbrock function}
\PYG{k+kn}{from} \PYG{n+nn}{\PYGZus{}\PYGZus{}future\PYGZus{}\PYGZus{}} \PYG{k+kn}{import} \PYG{n}{print\PYGZus{}function}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{dfbgn}

\PYG{c+c1}{\PYGZsh{} Define the objective function}
\PYG{k}{def} \PYG{n+nf}{rosenbrock}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{10.0} \PYG{o}{*} \PYG{p}{(}\PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{*}\PYG{o}{*} \PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{1.0} \PYG{o}{\PYGZhy{}} \PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Define the starting point}
\PYG{n}{x0} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.2}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} DFBGN is a randomized algorithm \PYGZhy{} set random seed for reproducibility}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Call DFBGN}
\PYG{n}{soln} \PYG{o}{=} \PYG{n}{dfbgn}\PYG{o}{.}\PYG{n}{solve}\PYG{p}{(}\PYG{n}{rosenbrock}\PYG{p}{,} \PYG{n}{x0}\PYG{p}{,} \PYG{n}{fixed\PYGZus{}block}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Display output}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{soln}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Note that DFBGN is a randomized algorithm: the subspace it searches is randomly generated. The output of this script, showing that DFBGN finds the correct solution, is
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
****** DFBGN Results ******
Solution xmin = [ 1.          0.99999998]
Residual vector = [ \PYGZhy{}1.61462722e\PYGZhy{}07   0.00000000e+00]
Objective value f(xmin) = 2.607021062e\PYGZhy{}14
Needed 72 objective evaluations
No approximate Jacobian available
Exit flag = 0
Success: Objective is sufficiently small
****************************
\end{sphinxVerbatim}
\end{quote}

This and all following problems can be found in the \sphinxhref{https://github.com/numericalalgorithmsgroup/dfbgn/tree/master/examples}{examples} directory on the DFBGN Github page.


\section{More Output}
\label{\detokenize{userguide:more-output}}
We can get DFBGN to print out more detailed information about its progress using the \sphinxhref{https://docs.python.org/3/library/logging.html}{logging} module. To do this, we need to add the following lines:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{logging}
\PYG{n}{logging}\PYG{o}{.}\PYG{n}{basicConfig}\PYG{p}{(}\PYG{n}{level}\PYG{o}{=}\PYG{n}{logging}\PYG{o}{.}\PYG{n}{INFO}\PYG{p}{,} \PYG{n+nb}{format}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZpc{}(message)s}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} ... (call dfbgn.solve)}
\end{sphinxVerbatim}
\end{quote}

And we can now see each evaluation of \sphinxcode{\sphinxupquote{objfun}}:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Function eval 1 has f = 24.2 at x = [\PYGZhy{}1.2  1. ]
Function eval 2 has f = 63.2346372977649 at x = [\PYGZhy{}1.30493146  0.94178154]
Function eval 3 has f = 27.9653746738959 at x = [\PYGZhy{}1.25821846  1.10493146]
Function eval 4 has f = 6.33451236346909 at x = [\PYGZhy{}1.08861669  1.04465151]
...
Function eval 70 has f = 1.99643713755605e\PYGZhy{}12 at x = [ 1.          1.00000014]
Function eval 71 has f = 110.765405382932 at x = [ 0.45748543 \PYGZhy{}0.84175933]
Function eval 72 has f = 2.60702106219341e\PYGZhy{}14 at x = [ 1.          0.99999998]
\end{sphinxVerbatim}
\end{quote}

If we wanted to save this output to a file, we could replace the above call to \sphinxcode{\sphinxupquote{logging.basicConfig()}} with
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{logging}\PYG{o}{.}\PYG{n}{basicConfig}\PYG{p}{(}\PYG{n}{filename}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{myfile.log}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{level}\PYG{o}{=}\PYG{n}{logging}\PYG{o}{.}\PYG{n}{INFO}\PYG{p}{,}
                    \PYG{n+nb}{format}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZpc{}(message)s}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{filemode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{w}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}


\section{Example: Noisy Objective Evaluation}
\label{\detokenize{userguide:example-noisy-objective-evaluation}}
As described in \DUrole{xref,std,std-doc}{info}, derivative\sphinxhyphen{}free algorithms such as DFBGN are particularly useful when \sphinxcode{\sphinxupquote{objfun}} has noise. Let’s modify the previous example to include random noise in our objective evaluation, and compare it to a derivative\sphinxhyphen{}based solver:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} DFBGN example: minimize the noisy Rosenbrock function}
\PYG{k+kn}{from} \PYG{n+nn}{\PYGZus{}\PYGZus{}future\PYGZus{}\PYGZus{}} \PYG{k+kn}{import} \PYG{n}{print\PYGZus{}function}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{dfbgn}

\PYG{c+c1}{\PYGZsh{} Define the objective function}
\PYG{k}{def} \PYG{n+nf}{rosenbrock}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{10.0} \PYG{o}{*} \PYG{p}{(}\PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{*}\PYG{o}{*} \PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{1.0} \PYG{o}{\PYGZhy{}} \PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Modified objective function: add 1\PYGZpc{} Gaussian noise}
\PYG{k}{def} \PYG{n+nf}{rosenbrock\PYGZus{}noisy}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{rosenbrock}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)} \PYG{o}{*} \PYG{p}{(}\PYG{l+m+mf}{1.0} \PYG{o}{+} \PYG{l+m+mf}{1e\PYGZhy{}2} \PYG{o}{*} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{normal}\PYG{p}{(}\PYG{n}{size}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Define the starting point}
\PYG{n}{x0} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.2}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set random seed (for reproducibility)}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Demonstrate noise in function evaluation:}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{objfun(x0) = }\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rosenbrock\PYGZus{}noisy}\PYG{p}{(}\PYG{n}{x0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Call DFBGN}
\PYG{n}{soln} \PYG{o}{=} \PYG{n}{dfbgn}\PYG{o}{.}\PYG{n}{solve}\PYG{p}{(}\PYG{n}{rosenbrock\PYGZus{}noisy}\PYG{p}{,} \PYG{n}{x0}\PYG{p}{,} \PYG{n}{fixed\PYGZus{}block}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Display output}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{soln}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Compare with a derivative\PYGZhy{}based solver}
\PYG{k+kn}{import} \PYG{n+nn}{scipy}\PYG{n+nn}{.}\PYG{n+nn}{optimize} \PYG{k}{as} \PYG{n+nn}{opt}
\PYG{n}{soln} \PYG{o}{=} \PYG{n}{opt}\PYG{o}{.}\PYG{n}{least\PYGZus{}squares}\PYG{p}{(}\PYG{n}{rosenbrock\PYGZus{}noisy}\PYG{p}{,} \PYG{n}{x0}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{** SciPy results **}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Solution xmin = }\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{soln}\PYG{o}{.}\PYG{n}{x}\PYG{p}{)}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Objective value f(xmin) = }\PYG{l+s+si}{\PYGZpc{}.10g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{l+m+mf}{2.0} \PYG{o}{*} \PYG{n}{soln}\PYG{o}{.}\PYG{n}{cost}\PYG{p}{)}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Needed }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{ objective evaluations}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{soln}\PYG{o}{.}\PYG{n}{nfev}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Exit flag = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{soln}\PYG{o}{.}\PYG{n}{status}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{soln}\PYG{o}{.}\PYG{n}{message}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

The output of this is:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Demonstrate noise in function evaluation:
objfun(x0) = [\PYGZhy{}4.4776183   2.20880346]
objfun(x0) = [\PYGZhy{}4.44306447  2.24929965]
objfun(x0) = [\PYGZhy{}4.48217255  2.17849989]
objfun(x0) = [\PYGZhy{}4.44180389  2.19667014]
objfun(x0) = [\PYGZhy{}4.39545837  2.20903317]

****** DFBGN Results ******
Solution xmin = [ 1.          0.99999994]
Residual vector = [ \PYGZhy{}6.31017296e\PYGZhy{}07   5.73947373e\PYGZhy{}10]
Objective value f(xmin) = 3.981831569e\PYGZhy{}13
Needed 82 objective evaluations
No approximate Jacobian available
Exit flag = 0
Success: Objective is sufficiently small
****************************


** SciPy results **
Solution xmin = [\PYGZhy{}1.19999679  1.00000624]
Objective value f(xmin) = 23.47462704
Needed 8 objective evaluations
Exit flag = 3
`xtol` termination condition is satisfied.
\end{sphinxVerbatim}
\end{quote}

DFBGN is able to find the solution with 10 more function evaluations as in the noise\sphinxhyphen{}free case. However SciPy’s derivative\sphinxhyphen{}based solver, which has no trouble solving the noise\sphinxhyphen{}free problem, is unable to make any progress.


\section{Example: Solving a Nonlinear System of Equations}
\label{\detokenize{userguide:example-solving-a-nonlinear-system-of-equations}}
Lastly, we give an example of using DFBGN to solve a nonlinear system of equations (taken from \sphinxhref{http://support.sas.com/documentation/cdl/en/imlug/66112/HTML/default/viewer.htm\#imlug\_genstatexpls\_sect004.htm}{here}). We wish to solve the following set of equations
\begin{equation*}
\begin{split}x_1 + x_2 - x_1 x_2 + 2 &= 0, \\
x_1 \exp(-x_2) - 1 &= 0.\end{split}
\end{equation*}
The code for this is:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} DFBGN example: Solving a nonlinear system of equations}
\PYG{c+c1}{\PYGZsh{} Originally from:}
\PYG{c+c1}{\PYGZsh{} http://support.sas.com/documentation/cdl/en/imlug/66112/HTML/default/viewer.htm\PYGZsh{}imlug\PYGZus{}genstatexpls\PYGZus{}sect004.htm}

\PYG{k+kn}{from} \PYG{n+nn}{\PYGZus{}\PYGZus{}future\PYGZus{}\PYGZus{}} \PYG{k+kn}{import} \PYG{n}{print\PYGZus{}function}
\PYG{k+kn}{from} \PYG{n+nn}{math} \PYG{k+kn}{import} \PYG{n}{exp}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{dfbgn}

\PYG{c+c1}{\PYGZsh{} Want to solve:}
\PYG{c+c1}{\PYGZsh{}   x1 + x2 \PYGZhy{} x1*x2 + 2 = 0}
\PYG{c+c1}{\PYGZsh{}   x1 * exp(\PYGZhy{}x2) \PYGZhy{} 1   = 0}
\PYG{k}{def} \PYG{n+nf}{nonlinear\PYGZus{}system}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{+} \PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{*}\PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{+} \PYG{l+m+mi}{2}\PYG{p}{,}
                     \PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{*} \PYG{n}{exp}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Warning: if there are multiple solutions, which one}
\PYG{c+c1}{\PYGZsh{}          DFBGN returns will likely depend on x0!}
\PYG{n}{x0} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{2.0}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} DFBGN is a randomized algorithm \PYGZhy{} set random seed for reproducibility}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Call DFBGN}
\PYG{n}{soln} \PYG{o}{=} \PYG{n}{dfbgn}\PYG{o}{.}\PYG{n}{solve}\PYG{p}{(}\PYG{n}{nonlinear\PYGZus{}system}\PYG{p}{,} \PYG{n}{x0}\PYG{p}{,} \PYG{n}{fixed\PYGZus{}block}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Display output}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{soln}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

The output of this is
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
****** DFBGN Results ******
Solution xmin = [ 0.09777311 \PYGZhy{}2.32510592]
Residual vector = [  2.38996951e\PYGZhy{}08   2.23316848e\PYGZhy{}07]
Objective value f(xmin) = 5.044160988e\PYGZhy{}14
Needed 18 objective evaluations
No approximate Jacobian available
Exit flag = 0
Success: Objective is sufficiently small
****************************
\end{sphinxVerbatim}
\end{quote}

Here, we see that both entries of the residual vector are very small, so both equations have been solved to high accuracy.


\section{References}
\label{\detokenize{userguide:references}}

\chapter{Acknowledgements}
\label{\detokenize{index:acknowledgements}}
This software was developed under the supervision of \sphinxhref{https://www.maths.ox.ac.uk/people/coralia.cartis}{Coralia Cartis}, and was supported by the EPSRC Centre For Doctoral Training in \sphinxhref{https://www.maths.ox.ac.uk/study-here/postgraduate-study/industrially-focused-mathematical-modelling-epsrc-cdt}{Industrially Focused Mathematical Modelling} (EP/L015803/1) in collaboration with the \sphinxhref{http://www.nag.com/}{Numerical Algorithms Group}.

\begin{sphinxthebibliography}{CR2021}
\bibitem[CR2021]{userguide:cr2021}
Coralia Cartis and Lindon Roberts, \sphinxhref{https://arxiv.org/abs/2102.12016}{Scalable Subspace Methods for Derivative\sphinxhyphen{}Free Nonlinear Least\sphinxhyphen{}Squares Optimization}, \sphinxstyleemphasis{arXiv preprint arXiv:2102.12016}, (2021).
\end{sphinxthebibliography}



\renewcommand{\indexname}{Index}
\printindex
\end{document}